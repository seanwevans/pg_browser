ALTER TABLE pgb_session.history

    ALTER COLUMN n ADD GENERATED BY DEFAULT AS IDENTITY;

SELECT setval(
    pg_get_serial_sequence('pgb_session.history', 'n'),
    COALESCE((
        SELECT n
        FROM pgb_session.history
        ORDER BY n DESC
        LIMIT 1
    ), 0),
    true
);

ALTER TABLE pgb_session.history
    ALTER COLUMN n DROP IDENTITY IF EXISTS,
    ALTER COLUMN n TYPE BIGINT;


\ir 60_pgb_session_open.sql

\ir 60_pgb_session_reload.sql
